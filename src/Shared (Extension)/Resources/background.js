(()=>{function f(t,s){let a=t.split(".").map(Number),r=s.split(".").map(Number);for(let o=0;o<Math.max(a.length,r.length);o++){let n=a[o]||0,c=r[o]||0;if(n>c)return 1;if(n<c)return-1}return 0}function l(t,s){return t?f(t,s)<0:!0}var e=typeof browser<"u"?browser:chrome,d=720*60*60*1e3;function h(t,s,a){if(t.type==="PROFILE_INFO_EXTRACTED")return console.log("[Threads Extractor] Profile info received:",t.data),e.storage.local.get(["profileCache"]).then(r=>{let o=r.profileCache||{},n=t.data.username;n&&(o[n]={...t.data,timestamp:Date.now()},e.storage.local.set({profileCache:o}))}),!1;if(t.type==="GET_CACHED_PROFILES")return e.storage.local.get(["profileCache"]).then(r=>{a(r.profileCache||{})}),!0;if(t.type==="STORE_USER_IDS"){let r=t.data;return e.storage.local.get(["userIdCache"]).then(o=>{let n=o.userIdCache||{},c=Date.now();for(let[i,u]of Object.entries(r))n[i]||(n[i]={userId:u,timestamp:c});e.storage.local.set({userIdCache:n})}),!1}return t.type==="GET_USER_ID_CACHE"?(e.storage.local.get(["userIdCache"]).then(r=>{a(r.userIdCache||{})}),!0):(t.type==="OPEN_ONBOARDING"&&e.tabs.create({url:e.runtime.getURL("onboarding.html")}),!1)}e.runtime.onMessage.addListener(h);var g="0.3.5";e.runtime.onInstalled.addListener(t=>{let s=e.runtime.getManifest().version;t.reason==="install"?(e.tabs.create({url:e.runtime.getURL("onboarding.html")}),e.storage.local.set({onboardingLastSeenVersion:s})):t.reason==="update"&&e.storage.local.get(["onboardingLastSeenVersion"]).then(a=>{let r=a.onboardingLastSeenVersion;l(r,g)?(e.tabs.create({url:e.runtime.getURL("onboarding.html")}),e.storage.local.set({onboardingLastSeenVersion:s})):e.storage.local.set({onboardingLastSeenVersion:s})})});e.runtime.onStartup.addListener(()=>{let t=Date.now(),s=4320*60*1e3;e.storage.local.get(["profileCache"]).then(a=>{let r=a.profileCache||{},o={};for(let[n,c]of Object.entries(r))t-c.timestamp<s&&(o[n]=c);e.storage.local.set({profileCache:o})}),e.storage.local.get(["userIdCache"]).then(a=>{let r=a.userIdCache||{},o={};for(let[n,c]of Object.entries(r))t-c.timestamp<d&&(o[n]=c);e.storage.local.set({userIdCache:o})})});})();
//# sourceMappingURL=background.js.map

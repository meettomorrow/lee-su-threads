name: Auto PR Description

on:
  pull_request:
    types: [opened]

jobs:
  generate-description:
    # Only run if PR body is empty
    if: github.event.pull_request.body == ''
    runs-on: ubuntu-latest
    timeout-minutes: 10

    permissions:
      contents: read
      pull-requests: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Generate PR Description
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            This pull request has an empty description. Please generate a comprehensive PR description by:

            1. Analyzing the code changes in this PR (use gh pr diff or git diff)
            2. Reading the commit messages for context
            3. Understanding the purpose and scope of changes

            Then create a well-structured PR description with:

            ## Summary
            A brief overview of what this PR does (2-3 sentences)

            ## Changes
            - List of key changes made
            - Organized by component/area if applicable

            ## Type of Change
            - [ ] Bug fix (non-breaking change which fixes an issue)
            - [ ] New feature (non-breaking change which adds functionality)
            - [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
            - [ ] Documentation update
            - [ ] Refactoring (no functional changes)
            - [ ] Performance improvement
            - [ ] Other (please describe)

            ## Testing
            - Describe what testing was done
            - Note any areas that need additional testing

            After generating the description, update the PR using:
            gh pr edit ${{ github.event.pull_request.number }} --body "YOUR_GENERATED_DESCRIPTION"

            Make the description clear, professional, and helpful for reviewers.
          claude_args: '--allowedTools "Bash(gh pr:*),Bash(git:*)"'
